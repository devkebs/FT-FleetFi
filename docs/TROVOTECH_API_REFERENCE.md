# TROVO TOKENIZATION ENGINE - API DOCUMENTATION

**Version:** 1.0  
**Last Updated:** November 13, 2025  
**Integration Partner:** Trovotech

---

## üìã Table of Contents

1. [Base URLs](#base-urls)
2. [Authentication & Authorization](#authentication--authorization)
3. [Wallet Management](#wallet-management)
4. [User Onboarding](#user-onboarding)
5. [KYC Management](#kyc-management)
6. [Token Minting (Two-Phase)](#token-minting)
7. [Error Handling](#error-handling)
8. [Code Examples](#code-examples)

---

## üåê Base URLs

| Environment | URL |
|------------|-----|
| **Sandbox/Testnet** | `https://apidev.trovotechnologies.com` |
| **Production/Mainnet** | `https://api.trovotechnologies.com` |

---

## üîê Authentication & Authorization

### Required Headers

All API requests must include the following headers:

| Header | Description | Required |
|--------|-------------|----------|
| `X-TW-SERVICE-LINK-API-KEY` | Your service link API key | ‚úÖ Always |
| `X-TW-PUBLIC-KEY` | Public key of the wallet being accessed | For wallet operations |
| `X-TW-SIGNER` | Public key of the signer for the wallet | For transaction signing |

### Error Response Structure

```json
{
  "error": "error-code",
  "data": "parameterAffected",
  "message": "Human-readable error message"
}
```

**Example Error:**

```json
{
  "error": "error-invalid-primary-signer-public-key",
  "data": "primarySigner",
  "message": "Invalid Primary Signer Public key."
}
```

---

## üîë Wallet Management

### Generating Wallet Seed or Keypair

Wallets are based on the Stellar blockchain protocol. You can generate wallets using compatible Stellar SDKs.

**Important Notes:**
- Secret keys start with `S`
- Public keys start with `G` (not numbers, not `S`)

#### Generate New Keypair (Node.js)

```javascript
import { Keypair } from '@stellar/stellar-sdk';

// Generate a random Stellar keypair
const pair = Keypair.random();

// Get the secret seed and public key
const secret = pair.secret();
const publicKey = pair.publicKey();

console.log('Secret Seed:', secret);
console.log('Public Key:', publicKey);
```

#### Parse Existing Seed/Secret Key

```javascript
import { Keypair } from '@stellar/stellar-sdk';

// Your Stellar secret seed (starts with 'S')
const seed = 'SXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX';

// Parse the seed to get the Keypair object
const keypair = Keypair.fromSecret(seed);

// Access the public key and raw key material
console.log('Public Key:', keypair.publicKey());
console.log('Raw Secret (Buffer):', keypair.rawSecretKey()); // Uint8Array of bytes
```

---

## üë§ User Onboarding

### Onboard New Users/Customers

**Endpoint:** `POST /v1/trovo-api/users/onboard`

Creates a Trovo app profile and a default primary wallet. The wallet address is the public key you submit; the wallet alias is generated by the Trovo API and returned in the response.

**Required Headers:**
- `X-TW-SERVICE-LINK-API-KEY`

#### Request Body

```json
{
  "email": "string",
  "firstName": "string",
  "lastName": "string",
  "mobile": "string",
  "mobileCountryCode": "string",
  "publicKey": "string",
  "primarySigner": "string",
  "referrer": "string",
  "corporate": 0
}
```

**Field Descriptions:**

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `email` | string | ‚úÖ | User email address |
| `firstName` | string | ‚úÖ | First name, or company name when `corporate = 1` |
| `lastName` | string | ‚ùå | Last name (optional, valid when `corporate = 1`) |
| `mobile` | string | ‚úÖ | Mobile phone number |
| `mobileCountryCode` | string | ‚úÖ | Country code (e.g., "+234") |
| `publicKey` | string | ‚úÖ | Wallet public key to tie to the profile |
| `primarySigner` | string | ‚úÖ | Public key of the secret key; if not recovered, same as profile public key |
| `referrer` | string | ‚ùå | Referrer username (optional) |
| `corporate` | integer | ‚ùå | Default `0` = individual, `1` = corporate |

#### Response

```json
{
  "username": "string",
  "email": "string",
  "firstName": "string",
  "lastName": "string",
  "mobile": "string",
  "mobileCountryCode": "string",
  "publicKey": "string",
  "primarySigner": "string",
  "referrer": "string",
  "corporate": 0
}
```

**Status Codes:**
- `200 OK` - User onboarded successfully
- `4xx/5xx` - Error (see error response structure)

---

## üìù KYC Management

### Update Service Users KYC Status

**Endpoint:** `POST /v1/trovo-api/users/update-kyc`

**Important:** You can only modify the KYC status for users created through your service link.

**Required Headers:**
- `X-TW-SERVICE-LINK-API-KEY`

#### KYC Levels

| Level | Description | Capabilities |
|-------|-------------|--------------|
| **1** | Full name (ID), Email, DoB, NIN, BVN (card), Passport/Driver's License | Send/receive virtual assets in Trovo App |
| **2** | Residential Address, Proof of Address, Occupation/Business | Limited swap transactions up to 100k NGN |
| **3** | Facial and Identity Verification (Liveness) | Tokenized asset purchases, P2P trading, stablecoin withdrawals to fiat |
| **4** | Enhanced Due Diligence (EDD) | Detailed funds sources and ongoing monitoring |

#### Request Body

```json
{
  "targetTrovoUsername": "string",
  "kycStatus": 1,
  "kycJsonData": "string"
}
```

**Field Descriptions:**

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `targetTrovoUsername` | string | ‚úÖ | Trovo username of the user to update |
| `kycStatus` | integer | ‚úÖ | KYC level (1-4) |
| `kycJsonData` | string | ‚úÖ | Raw KYC JSON data from your KYC provider |

#### Response

```json
{
  "targetTrovoUsername": "string",
  "kycStatus": 1,
  "kycJsonData": "string"
}
```

**Status Codes:**
- `200 OK` - KYC updated successfully
- `4xx/5xx` - Error

---

## ü™ô Token Minting

### Mint a Token (Two-Phase Process)

**Endpoint:** `POST /v1/trovo-api/tokens/mint`

Token minting uses a **two-phase transaction flow**:

1. **Phase 1:** Initial request creates unsigned transaction
2. **Phase 2:** Sign transaction and submit signed data

**Required Headers:**
- `X-TW-SERVICE-LINK-API-KEY`
- `X-TW-PUBLIC-KEY` (issuer's public key)
- `X-TW-SIGNER` (signer's public key)

#### Important Notes

- Use a **sub-wallet** for minting
- If using shared access, grant the owner **INITIATOR PRIVILEGE** on the subwallet
- The destination must be a subwallet; otherwise, the transaction may fail
- Maximum memo length: 28 bytes

### Phase 1: Initial Request

#### Request Body

```json
{
  "destination": "string",
  "memo": "string",
  "assetIssuer": "string",
  "assetCode": "string",
  "amount": "string"
}
```

**Field Descriptions:**

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `destination` | string | ‚úÖ | Public key or Trovo username of subwallet recipient |
| `memo` | string | ‚ùå | Optional memo (max 28 bytes) |
| `assetIssuer` | string | ‚úÖ | 56-character public key of the issuer |
| `assetCode` | string | ‚úÖ | Asset code (up to 12 alphanumeric characters) |
| `amount` | string | ‚úÖ | Token units to mint |

#### Phase 1 Response

The API returns the unsigned transaction with additional metadata:

```json
{
  "destination": "string",
  "memo": "string",
  "assetIssuer": "string",
  "assetCode": "string",
  "amount": "string",
  "transaction": "string",
  "transactionSignature": "",
  "transactionId": "",
  "networkPassPhrase": "string",
  "destinationFirstName": "string",
  "destinationLastName": "string",
  "destinationThumbnail": "string",
  "signatureRequired": 1,
  "commit": 0,
  "messages": []
}
```

**Key Fields:**

| Field | Description |
|-------|-------------|
| `transaction` | XDR-encoded transaction string (sign this!) |
| `networkPassPhrase` | Network identifier for transaction signing |
| `signatureRequired` | `1` = signature required, `0` = not required |
| `commit` | `0` for initial submission, `1` for commit |
| `messages` | Array of warnings/messages from the API |

**Status Code:** `202 Accepted`

### Transaction Signing

Use the Stellar SDK to sign the transaction:

```javascript
import { Keypair, TransactionBuilder } from '@stellar/stellar-sdk';

// XDR transaction string from Phase 1 response
const transactionXdr = 'AAAAAgAAAADNwU/ZbB...';
const networkPassphrase = 'Bantu Testnet ; January 2022';

// Load transaction from XDR
const transaction = TransactionBuilder.fromXDR(
  transactionXdr, 
  networkPassphrase
);

// Load your signing keypair (secret starts with 'S')
const signer = Keypair.fromSecret('SXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX');

// Sign the transaction
transaction.sign(signer);

// Get the base64-encoded signature
const transactionSignature = transaction.signatures[0].signature().toString('base64');

console.log('‚úÖ Signature (base64):', transactionSignature);
```

### Phase 2: Submit Signed Transaction

#### Request Body

Take the entire response from Phase 1 and add your signature:

```json
{
  "destination": "string",
  "memo": "string",
  "assetIssuer": "string",
  "assetCode": "string",
  "amount": "string",
  "transaction": "string",
  "transactionSignature": "YOUR_SIGNATURE_HERE",
  "transactionId": "",
  "networkPassPhrase": "string",
  "destinationFirstName": "string",
  "destinationLastName": "string",
  "destinationThumbnail": "string",
  "signatureRequired": 1,
  "commit": 1,
  "messages": []
}
```

#### Phase 2 Response

```json
{
  "destination": "string",
  "memo": "string",
  "assetIssuer": "string",
  "assetCode": "string",
  "amount": "string",
  "transaction": "string",
  "transactionSignature": "string",
  "transactionId": "TRANSACTION_HASH_OR_PENDING_AUTH",
  "networkPassPhrase": "string",
  "destinationFirstName": "string",
  "destinationLastName": "string",
  "destinationThumbnail": "string",
  "signatureRequired": 1,
  "commit": 1,
  "messages": []
}
```

**Key Fields:**

| Field | Description |
|-------|-------------|
| `transactionId` | Transaction hash if successful on-chain, or `PENDING_AUTH` for shared access |

**Status Code:** `200 OK`

---

## üíª Code Examples

### Complete Token Minting Example (Node.js)

```javascript
import axios from "axios";
import { Keypair, Networks, Transaction } from "@stellar/stellar-sdk";

const BASE_URL = "https://apidev.trovotechnologies.com";
const API_KEY = "your_api_key_here";

async function mintToken() {
  try {
    // === 1Ô∏è‚É£ CONFIGURATION ===
    const API_URL = `${BASE_URL}/v1/trovo-api/tokens/mint`;

    // Issuer (the account that created the asset)
    const ISSUER_SECRET = "SXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX";
    const issuerKeypair = Keypair.fromSecret(ISSUER_SECRET);
    const assetIssuer = issuerKeypair.publicKey();

    // Destination (the account that will receive the token)
    const DESTINATION_SECRET = "SYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY";
    const destinationKeypair = Keypair.fromSecret(DESTINATION_SECRET);
    const destination = destinationKeypair.publicKey();

    // Asset details
    const assetCode = "FLEETFI";
    const amount = "1000000";
    const memo = "FleetFi token mint";

    // === 2Ô∏è‚É£ INITIAL REQUEST (Create unsigned transaction) ===
    const mintRequestBody = {
      assetCode,
      assetIssuer,
      destination,
      amount,
      memo,
    };

    console.log("üîπ Sending initial mint request...");
    const { data: unsignedTxResponse } = await axios.post(
      API_URL, 
      mintRequestBody,
      {
        headers: {
          'X-TW-SERVICE-LINK-API-KEY': API_KEY,
          'X-TW-PUBLIC-KEY': assetIssuer,
          'X-TW-SIGNER': issuerKeypair.publicKey(),
        }
      }
    );

    // The response should contain: Transaction (XDR) and NetworkPassPhrase
    const { 
      Transaction: xdr, 
      NetworkPassPhrase: networkPassphrase 
    } = unsignedTxResponse;

    if (!xdr || !networkPassphrase) {
      throw new Error(
        "Invalid response from mint endpoint ‚Äî missing transaction or networkPassPhrase"
      );
    }

    console.log("‚úÖ Received unsigned transaction from server.");

    // === 3Ô∏è‚É£ SIGN THE TRANSACTION ===
    const transaction = new Transaction(xdr, networkPassphrase);
    transaction.sign(destinationKeypair);

    const signedXdr = transaction.toEnvelope().toXDR("base64");
    const transactionSignature = transaction.signatures[0]
      .signature()
      .toString('base64');

    // === 4Ô∏è‚É£ SECOND CALL ‚Äî Send back signed transaction ===
    const signedBody = {
      ...unsignedTxResponse,
      TransactionSignature: transactionSignature,
      Commit: 1,
    };

    console.log("üîπ Sending signed transaction back for mint commit...");
    const { data: finalResponse } = await axios.post(
      API_URL, 
      signedBody,
      {
        headers: {
          'X-TW-SERVICE-LINK-API-KEY': API_KEY,
          'X-TW-PUBLIC-KEY': assetIssuer,
          'X-TW-SIGNER': issuerKeypair.publicKey(),
        }
      }
    );

    // === 5Ô∏è‚É£ SUCCESS RESPONSE ===
    console.log("‚úÖ Token mint completed successfully!");
    console.log("Transaction ID:", finalResponse.TransactionID);
    console.log("Full response:", finalResponse);

  } catch (error) {
    console.error(
      "‚ùå Error minting token:", 
      error.response?.data || error.message
    );
  }
}

// Run the function
mintToken();
```

### User Onboarding Example

```javascript
import axios from "axios";
import { Keypair } from "@stellar/stellar-sdk";

const BASE_URL = "https://apidev.trovotechnologies.com";
const API_KEY = "your_api_key_here";

async function onboardUser(userData) {
  try {
    // Generate a new wallet for the user
    const keypair = Keypair.random();
    
    const response = await axios.post(
      `${BASE_URL}/v1/trovo-api/users/onboard`,
      {
        email: userData.email,
        firstName: userData.firstName,
        lastName: userData.lastName,
        mobile: userData.mobile,
        mobileCountryCode: userData.mobileCountryCode,
        publicKey: keypair.publicKey(),
        primarySigner: keypair.publicKey(),
        corporate: 0,
      },
      {
        headers: {
          'X-TW-SERVICE-LINK-API-KEY': API_KEY,
        }
      }
    );

    console.log("‚úÖ User onboarded successfully!");
    console.log("Username:", response.data.username);
    console.log("Public Key:", response.data.publicKey);
    
    // IMPORTANT: Store the secret key securely!
    console.log("Secret Key (STORE SECURELY):", keypair.secret());
    
    return response.data;
  } catch (error) {
    console.error(
      "‚ùå Error onboarding user:", 
      error.response?.data || error.message
    );
    throw error;
  }
}

// Example usage
onboardUser({
  email: "investor@fleetfi.com",
  firstName: "John",
  lastName: "Doe",
  mobile: "8012345678",
  mobileCountryCode: "+234",
});
```

---

## üõ†Ô∏è Integration Checklist

- [ ] Set up API credentials (service link API key)
- [ ] Install Stellar SDK (`npm install @stellar/stellar-sdk`)
- [ ] Implement wallet generation for new users
- [ ] Implement user onboarding flow
- [ ] Set up KYC integration with your provider
- [ ] Implement two-phase token minting
- [ ] Set up secure storage for private keys
- [ ] Test in sandbox environment
- [ ] Implement error handling and logging
- [ ] Move to production with mainnet credentials

---

## üìö Additional Resources

- [Stellar SDK Documentation](https://stellar.github.io/js-stellar-sdk/)
- [Bantu Blockchain Network](https://bantu.network)
- [Trovotech Support](https://trovotechnologies.com/support)

---

**Document End**
